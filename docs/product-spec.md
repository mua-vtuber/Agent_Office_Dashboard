# Product Specification

## 1. 배경
사용자는 "팀 에이전트가 실제 사무실처럼 일하는 느낌"과 "운영 관점에서 현재 상태를 빠르게 파악"하는 두 가지를 동시에 원한다.
기존 CLI 중심 작업은 상태 파악이 어렵고, 팀장-팀원 간 지시/보고 흐름이 시각적으로 드러나지 않는다.

## 2. 문제 정의
- 현재 문제:
  - 누가 어떤 작업을 수행 중인지 파악이 어렵다.
  - 지시/협업/완료 같은 상호작용이 텍스트 로그에 묻힌다.
  - 작업 병목, 실패, 장시간 작업을 즉시 발견하기 어렵다.
- 해결 방향:
  - 이벤트 중심 실시간 모델을 구축하고,
  - 같은 이벤트를 "오피스 시각화"와 "운영 대시보드"에 이중 투영한다.

## 3. 목표
- 실시간으로 에이전트의 현재 상태를 한눈에 파악한다.
- 팀장-팀원 지시/보고 상호작용을 직관적으로 연출한다.
- 운영자에게 액션 가능한 정보(지연, 실패, 대기)를 제공한다.

## 4. 비목표 (MVP)
- 조직 단위 장기 분석(월간/분기 리포트)
- 외부 고객 대상 공개 서비스 기능
- 복잡한 3D 렌더링

## 5. 사용자 유형
- 운영자(Owner): 전체 상태 모니터링, 실패 감지
- 팀장(Manager): 작업 분배 및 진행 확인
- 개발자(Observer): 현재 작업 맥락 파악

## 6. 핵심 사용 시나리오
1. 운영자가 접속하면, 현재 모든 에이전트가 자리에서 무엇을 하는지 즉시 본다.
2. 팀장이 특정 워커에 작업을 할당하면, 두 캐릭터가 서로 접근해 대화한 뒤 워커가 자리로 돌아가 작업한다.
3. 워커가 실패/입력대기 상태가 되면, 대시보드에 경고 표시되고 오피스 탭에서도 시각적으로 표시된다.
4. 운영자가 Settings 탭에서 좌석 위치나 연출 규칙을 바꾸면 즉시 반영된다.

## 7. 기능 요구사항

### 7.1 Office 탭
- 필수:
  - 에이전트별 고정 좌석 표시
  - 기본 레이아웃 프로필 `kr_t_left_v2` 지원
  - 좌측 T 클러스터 + 중앙 팀원 블록 + 우측 탕비실 구조 반영
  - 좌하단 입구에서 우측 탕비실로 연결되는 빈 동선 반영
  - 상태별 애니메이션(idle/working/handoff/meeting/returning/pending_input/failed/completed/roaming/breakroom/resting)
  - 팀장-팀원 지시/보고 시 "서로 마주보기" 연출
  - 간단한 말풍선(요약 텍스트)
  - 작업 중 머리 위 흰 종이 + 필기(획) 이펙트
  - 실패 시 절규 모션
  - 유휴/완료 후 탕비실 이동 또는 좌석 `Zzz` 수면 연출
- 선택:
  - 배경 테마 전환
  - 캐릭터 스킨 전환

### 7.2 Dashboard 탭
- 필수:
  - 에이전트 상태 카드(현재 상태, 마지막 이벤트 시각)
  - 활성 작업 목록(task_id, 담당자, 경과 시간)
  - 이벤트 타임라인(최근 N건)
  - 스코프 필터(workspace / terminal session / run)
  - Time Travel 디버깅 진입(실패 이벤트 기준 전후 문맥 조회)
  - 실패/지연 강조 표시
- 선택:
  - 필터(에이전트, 이벤트 타입, 시간)
  - 간단 통계(시간당 이벤트 수)

### 7.3 Settings 탭
- 필수:
  - 언어 설정(i18n: `ko`, `en`)
  - 시간대/시간표시 형식 설정
  - 에이전트 분류/역할 표시 정책(`정직원`/`계약직`, Manager/Worker)
  - 좌석 좌표 편집
  - 이벤트 -> 상태 전이 매핑
  - 서버 연결(WebSocket URL)
- 선택:
  - 애니메이션 속도
  - 경고 임계치

### 7.4 Agents 탭
- 필수:
  - 전체 에이전트 목록 표시(활성/비활성 포함)
  - 라벨 표시: 저장 에이전트는 `정직원`, 임시 호출 에이전트는 `계약직`
  - 에이전트 상세(소개, 역할, 도구, 최근 활동)
  - 필터: 라벨/역할/상태
  - Office 탭 하이라이트 연동
- 선택:
  - 이름/활동 기준 정렬
  - 상세 패널에서 최근 이벤트 미리보기

## 8. 비기능 요구사항
- 실시간 반영: 이벤트 발생 후 화면 반영 지연 최소화
- 안정성: 이벤트 유실 최소화, 재연결 시 상태 복구
- 확장성: 에이전트 수 증가 시에도 성능 유지
- 유지보수성: 이벤트 스키마 버전 관리
- 국제화: UI 문구/시간/숫자 포맷의 locale 분리

## 9. 성공 지표 (MVP)
- 신규 사용자 온보딩 10분 이내에 현재 상태 파악 가능
- 주요 이벤트 반영 지연 p95 < 1초
- 동시 20 에이전트 기준 UI 30 FPS 이상 유지
- 이벤트 누락률 < 0.1% (수집기 기준)

## 10. 릴리즈 기준
- MUST:
  - 4개 탭 기본 동작(Office/Dashboard/Agents/Settings)
  - 상태머신 전이 정상
  - 실시간 이벤트 반영
- SHOULD:
  - 실패/지연 시각 경고
  - 기본 필터링
- COULD:
  - 스킨/테마 커스터마이징

## 11. 의존성
- 이벤트 입력원: Claude Code Hooks/세션 이벤트
- 백엔드: 수집기 + 브로드캐스트 서버
- 프론트엔드: 오피스 렌더러 + 대시보드 UI

## 12. 결정 로그
- 2026-02-13: Analytics API 없이도 시작 가능한 이벤트 기반 아키텍처 채택
